language: php

php:
  - 5.4

services:
  - mysql
  - mongodb
  - elasticsearch
env:
  - MONGO_VERSION=1.2.12
  - MONGO_VERSION=1.3.2
  - MONGO_VERSION=1.3.7
  - MONGO_VERSION=1.4.5
  - MONGO_VERSION=1.5.1

before_script:
# Install php packages
  - sudo apt-get update > /dev/null
  - phpenv config-add phpmongodb.ini
  - composer self-update
  - composer install --dev --no-interaction --prefer-dist
  - mysql -e "CREATE USER 'ojs'@'localhost' IDENTIFIED BY 'ojs';" -uroot
  - mysql -e "GRANT ALL PRIVILEGES ON * . * TO 'ojs'@'localhost';" -uroot
  - app/console doctrine:database:create
  - app/console doctrine:migrations:migratet > /dev/null
  - app/console doctrine:schema:create > /dev/null
  - chmod -R 777 app/cache app/logs
  - app/console --env=test cache:warmup
  - app/console assetic:dump

script: phpunit -c app
