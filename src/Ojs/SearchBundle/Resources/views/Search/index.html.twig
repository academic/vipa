{% extends '::ojsbase.html.twig' %}
{% block title %}{{ 'title.search'|trans }} {{ parent() }}{% endblock %}
{% set hideleft = 1 %}

{% block breadcrumb %}
    {% set list = [
    {'link': path('ojs_public_index'), 'title': 'ojs.title'|trans},
    {'title': 'search.results'|trans}
    ] %}
    {{ breadcrumb(list) }}
{% endblock %}

{% block body %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <form action="/search" method="get">
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="search-type-text">{{ (queryType~'search')|trans }}</span> <span class="caret"></span></button>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0)" class="select-search-type" data-type="basic">{{ ('basicsearch')|trans }}</a></li>
                                <li><a href="javascript:void(0)" class="select-search-type" data-type="advanced">{{ ('advancedsearch')|trans }}</a></li>
                                <li><a href="javascript:void(0)" class="select-search-type" data-type="tag">{{ ('tagsearch')|trans }}</a></li>
                            </ul>
                        </div>
                        <input type="text" name="q" class="form-control" value="{{ query }}">
                        <span class="input-group-btn">
                            <button class="btn btn-default" type="submit">{{ "search"|trans }}</button>
                        </span>
                    </div>
                    <input type="hidden" name="type" value="{{ queryType }}" id="search-type">
                </form>
            </div>
            <div class="col-sm-2"></div>
        </div>
        <hgroup class="page-header">
            <h2 class="lead">
                {% trans with {'%total%':total_count, '%term%':query} %}
                <strong class="text-danger">%total%</strong> results for <strong
                        class="text-danger">%term%</strong>
                {% endtrans %}
            </h2>
            <a href="{{ path('ojs_search_advanced') }}" class="btn btn-default">{{ 'advanced.search.builder'|trans }}</a>
            <a href="{{ path('ojs_tags_cloud') }}" class="btn btn-default">{{ 'tags.cloud'|trans }}</a>
        </hgroup>

        <section class="col-xs-12 col-sm-12 col-md-12">
            <div role="tabpanel" class="col-sm-3">
                <ul class="nav nav-stacked" role="tablist">
                    {% for key,result in results %}
                        {% if result.data|length > 0 %}
                            <li role="presentation" class="{% if loop.first %}in active{% endif %}">
                                <a href="#content_{{ key }}" aria-controls="content_{{ key }}" role="tab"
                                   data-toggle="tab">
                                    {{ result.type }}
                                    <span class="badge">{{ result.data|length }}</span>
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>

            <div class="tab-content col-sm-9">
                {% for key,result in results %}
                    <div role="tabpanel" class="tab-pane fade {% if loop.first %}in active{% endif %}"
                         id="content_{{ key }}">
                        <table class="table table-bordered">
                            <thead>

                            </thead>
                            <tbody>
                            {% for res in result.data %}
                                <tr>
                                    <td>
                                        <h4>
                                            <a href="{{ getTagDefinition(res)['route'] }}">{{ getTagDefinition(res)['name'] }}</a>
                                        </h4>
                                        {% if queryType == 'tag' %}
                                            <i class="fa fa-tags"></i> {{ "tags"|trans }}
                                            {% set tags = res.tags|split(',') %}
                                            {% for tag in tags %}
                                                <a href="/search?q={{ tag }}&type=tag"><span
                                                            class="badge">{{ tag }}</span></a>
                                            {% endfor %}
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endfor %}
            </div>
        </section>
    </div>
{% endblock %}
