{% extends '::ojsbase.html.twig' %}
{% block title %}{{ 'title.submission_new'|trans }} {{ parent() }}{% endblock %}
{% set hideleft = 1 %}
{% block stylesheets %}
    {{ parent() }}
    {% stylesheets '@submission_css' output="assets/prod/css/submission.css" filter="cssrewrite" %}
    <link rel="stylesheet" href="{{ asset_url }}" xmlns="http://www.w3.org/1999/html"/>
    {% endstylesheets %}
{% endblock %}

{% block body -%}
    <div class="panel panel-info panel-steps">
        <div class="panel-heading">
            <ul class="nav nav-wizard submission-progress" id="article-submission-steps">
                <li id="submission-progress-step1">
                    <a href="javascript:void(0)">
                        <span class="badge">1</span>
                        {{ "submission.starting"|trans }}
                    </a>
                </li>
                <li id="submission-progress-step2" class="active">
                    <a href="javascript:void(0)">
                        <span class="badge">2</span>
                        {{ "article.singular"|trans }}
                    </a>
                </li>
                <li id="submission-progress-step6 last-step">
                    <a href="javascript:void(0)">
                        <span class="badge">3</span>
                        {{ "preview"|trans }} & {{ "submit"|trans }}
                    </a>
                </li>
                <li id="resumeNote" class="text-right"></li>
            </ul>
        </div>
        <div class="panel-body">
            <div id="step1-container" class="step">
                {{ form_start(form) }}

                <div class="panel panel-info">
                    <div class="panel-heading">Article Meta Data</div>
                    <div class="panel-body">
                        {{ form_row(form.articleType) }}
                        {{ form_row(form.translations) }}
                    </div>
                </div>

                <div class="panel panel-info">
                    <div class="panel-heading">Article Authors</div>
                    <div id="articleauthor-forms" class="panel-body">
                        <textarea style="display: none" id="articleauthor-template" cols="30" rows="10">
                            {% filter escape %}
                                {{ include('@OjsJournal/NewArticleSubmission/_articleauthor_subform.html.twig', { 'form': form.articleAuthors.vars.prototype }) }}
                            {% endfilter %}
                        </textarea>
                        {% for articleauthorForm in form.articleAuthors %}
                            {{ include('@OjsJournal/NewArticleSubmission/_articleauthor_subform.html.twig', { 'form': articleauthorForm }) }}
                        {% endfor %}
                    </div>
                    <div class="panel-footer">
                        <button type="button" class="btn btn-success btn-sm" id="add-articleauthor"><i class="fa fa-plus"></i> Add Article Author</button>
                    </div>
                </div>
                <hr>
                <div class="panel panel-info">
                    <div class="panel-heading">Citiations</div>
                    <div id="citation-forms" class="panel-body">
                        <textarea style="display: none" id="citation-template" cols="30" rows="10">
                            {% filter escape %}
                                {{ include('@OjsJournal/NewArticleSubmission/_citiation_subform.html.twig', { 'form': form.citations.vars.prototype }) }}
                            {% endfilter %}
                        </textarea>
                        {% for citiationForm in form.citations %}
                            {{ include('@OjsJournal/NewArticleSubmission/_citiation_subform.html.twig', { 'form': citiationForm }) }}
                        {% endfor %}
                    </div>
                    <div class="panel-footer">
                        <button type="button" class="btn btn-success btn-sm" id="add-citation"><i class="fa fa-plus"></i> Add Citiation</button>
                    </div>
                </div>
                <hr>
                <div class="panel panel-info">
                    <div class="panel-heading">Article Files</div>
                    <div id="articlefile-forms" class="panel-body">
                        <textarea style="display: none" id="articlefile-template" cols="30" rows="10">
                        {% filter escape %}
                            {{ include('@OjsJournal/NewArticleSubmission/_articlefile_subform.html.twig', { 'form': form.articleFiles.vars.prototype }) }}
                        {% endfilter %}
                    </textarea>
                        {% for articlefileForm in form.articleFiles %}
                            {{ include('@OjsJournal/NewArticleSubmission/_articlefile_subform.html.twig', { 'form': articlefileForm }) }}
                        {% endfor %}
                    </div>
                    <div class="panel-footer">
                        <button type="button" class="btn btn-success btn-sm" id="add-articlefile"><i class="fa fa-plus"></i> Add Article File</button>
                    </div>
                </div>
                <hr>
                {{ form_row(form.save) }}
                {{ form_end(form) }}
            </div>
        </div>
    </div>
    <style>
        .submission-subform{
            margin: 5px;
            border: 1px solid #CCC;
            padding: 10px;
        }
    </style>
{% endblock %}

{% block javascripts %}

    {{ parent() }}

    <script type="text/javascript">

        $(document).ready(function () {
            $('#add-citation').on('click', function() {
                var formContainer = $('#citation-forms'),
                        template = $('#citation-template').val(),
                        newSrc;

                newSrc = $(template.replace(/__name__/g, formContainer.find('li').length));
                newSrc.appendTo(formContainer);
            });
            $('#citation-forms').on('click', '.submission-subform .remove-citation', function() {
                $(this).parent().remove();
            });

            $('#add-articlefile').on('click', function() {
                var formContainer = $('#articlefile-forms'),
                        template = $('#articlefile-template').val(),
                        newSrc;

                newSrc = $(template.replace(/__name__/g, formContainer.find('li').length));

                newSrc.appendTo(formContainer);
                newSrc.find('.jb_fileupload').jbFileUpload();
            });
            $('#articlefile-forms').on('click', '.submission-subform .remove-articlefile', function() {
                $(this).parent().remove();
            });
            $('#add-articleauthor').on('click', function() {
                var formContainer = $('#articleauthor-forms'),
                        template = $('#articleauthor-template').val(),
                        newSrc;

                newSrc = $(template.replace(/__name__/g, formContainer.find('li').length));

                newSrc.appendTo(formContainer);
            });
            $('#articleauthor-forms').on('click', '.submission-subform .remove-subform', function() {
                $(this).parent().remove();
            });
        });
    </script>
{% endblock %}
