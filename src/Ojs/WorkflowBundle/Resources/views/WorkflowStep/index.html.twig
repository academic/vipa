{% extends '::ojsbase.html.twig' %}

{% block breadcrumb %}
    {% set list = [
                {'link': path('dashboard'), 'title': 'Dashboard'},
                {'link': path('ojs_workflow_homepage'), 'title': 'Workflow'},
                {'title': 'Workflow Steps'}
] %}
    {{breadcrumb(list)}}
{% endblock %}

{% block body -%}
    <div class="panel">
        <div class="panel-heading">
            <h1>Workflow Steps</h1>
        </div>
        <div class="panel-body">
            {% for entity in steps %}
                <div class="list-group-item">

                    <span>
                        <a href="{{ path('workflowsteps_show', { 'id': entity.id } ) }}">
                            <strong>
                                {%if entity.firstStep%}<span class="badge">First</span>{%endif%}
                                {%if entity.lastStep%}<span class="badge">Last</span>{%endif%}
                                {{entity.title}}
                            </strong>
                        </a>

                        {%for role in entity.roles%}
                            <span class="label label-info">{{role.name}}</span>
                        {%endfor%}
                    </span>

                    <br>
                    <span>
                        <small>Next Steps :</small>
                        {% if entity.getOnlyReply() %}
                            <span class="label label-primary">
                                Only Reply
                                <i class="fa fa-ok"></i>
                            </span>
                        {% else %}
                            {%for step in entity.nextSteps%}
                                {% if step is not null %}
                                <a class="label label-success" href="{{path("workflowsteps_show",{"id":step.id})}}">{{step.title}}</a>
                                {% endif %}
                            {%endfor%}
                        {% endif %}
                    </span> 

                    <span class="pull-right btn-group">
                        <a class="btn btn-info btn-xs" href="{{path('workflowsteps_show',{ 'id': entity.id })}}">
                            <i class="fa fa-info"></i>
                        </a>
                        {% if isJournalManager() %}
                            <a class="btn btn-warning btn-xs" href="{{path('workflowsteps_edit',{ 'id': entity.id })}}">
                                <i class="fa fa-pencil"></i>
                            </a>
                            <a class="btn btn-danger btn-xs" href="{{path('workflowsteps_delete',{ 'id': entity.id })}}">
                                <i class="fa fa-trash"></i>
                            </a>
                        {% endif %}
                    </span>
                </div>
            {% endfor %}
            <hr>

            {% if isJournalManager() %}
                <a href="{{path('workflowstep_new')}}" class="btn btn-success">
                    <i class="fa fa-plus"></i> {{"create"|trans}}
                </a>
                    <a href="{{path('workflow_templates')}}" class="btn btn-info">
                    <i class="fa fa-archive"></i> {{"templates"|trans}}
                </a>
            {% endif %}
            <a class="btn btn-primary" target="_blank" href="{{ path("ojs_workflow_graph") }}">
                <i class="fa fa-eye"></i> {{"visualize"|trans}}
            </a>
        </div>
    </div>
{% endblock %}
